
def verificar_planos_trabalho():
    # Obter a lista de servidores do banco SQL Portalina
    servidores = pontalina("SELECT * FROM [ProgramaGestao].[VW_PlanoTrabalhoAUDIN]")

    # Obter a lista de férias do banco SQL Auditor
    ferias = auditoria("SELECT * FROM Ferias")

    # Verificar se a variável ferias é None
    if ferias is None:
        print("Erro: a função auditoria('SELECT * FROM Ferias') retornou None")
        return

    # Verificar se a variável ferias é iterável
    if not isinstance(ferias, (list, tuple)):
        print(f"Erro: a função auditoria('SELECT * FROM Ferias') retornou um valor não iterável: {ferias}")
        return

    # Verificar se o arquivo notificado.json existe
    try:
        with open('data/notificado.json', 'r') as f:
            notificados = json.load(f)
    except FileNotFoundError:
        notificados = {}

    # Para cada servidor na lista de servidores
    for servidor in servidores:
        # Verificar se a variável ferias é None

        # Obter a data atual
        hoje = datetime.now().date()

        # Criar uma lista vazia para armazenar os nomes dos servidores em férias
        servidores_em_ferias = []

        # Iterar sobre a lista de férias
        for ferias_servidor in ferias:
            # Obter o nome do servidor
            nome_servidor = ferias_servidor[0]
            
            # Iterar sobre os períodos de férias do servidor
            for i in range(1, len(ferias_servidor), 2):
                # Obter a data de início e a duração do período de férias
                data_inicio_str = ferias_servidor[i]
                duracao_str = ferias_servidor[i+1]
                
                # Verificar se data_inicio_str e duracao_str não estão vazios
                if data_inicio_str and duracao_str:
                    # Converter data_inicio_str para um objeto datetime
                    data_inicio = datetime.strptime(data_inicio_str, '%d/%m/%Y').date()
                    
                    # Converter duracao_str para um inteiro
                    duracao = int(duracao_str)
                    
                    # Calcular a data de término do período de férias
                    data_termino = data_inicio + timedelta(days=duracao)
                    
                    # Verificar se hoje está dentro do período de férias
                    if data_inicio <= hoje <= data_termino:
                        # Adicionar o nome do servidor à lista servidores_em_ferias
                        servidores_em_ferias.append(nome_servidor)
                        break

        if servidores_em_ferias is not None:
            # Verificar se o servidor está na lista de férias
            if any(servidor['NomeServidor'] == ferias_servidor['SERVIDOR/COLABORADOR'] for ferias_servidor in servidores_em_ferias):
                continue

            # Verificar o status SituacaoPactoTrabalho do servidor
            if servidor['SituacaoPactoTrabalho'] != 'Em execução':
                # Verificar se o servidor já foi notificado anteriormente
                if servidor['NomeServidor'] not in notificados:
                    # Enviar o primeiro aviso ao servidor
                    print('Enviando notificação para servidor ' + servidor['NomeServidor'])
                    valores = {'nome': servidor['NomeServidor']}
                    html_personalizado = personalizar_html('C:/Users/navinchandry.ruas/Documents/.git/Regras/mail/avisoNCob1.html', valores)
                    html_corrigido = corrigir_codificacao(html_personalizado)

                    enviar_notificacao(servidor['NomeServidor'], html_corrigido)
                    # Registrar no arquivo notificado.json que o servidor foi notificado uma vez
                    notificados[servidor['NomeServidor']] = 1
                elif notificados[servidor['NomeServidor']] == 1:
                    # Enviar o segundo aviso ao servidor e ao supervisor
                    print('Enviando segunda notificação para servidor ' + servidor['NomeServidor'])
                    valores = {'nome': servidor['NomeServidor']}
                    html_personalizado = personalizar_html('C:/Users/navinchandry.ruas/Documents/.git/Regras/mail/avisoNCob1.html', valores)
                    html_corrigido = corrigir_codificacao(html_personalizado)
                    enviar_notificacao(servidor['NomeServidor'], html_corrigido)
                    print('Enviando notificação para supervisor')
                    valores = {'nome': servidor['NomeServidor']}
                    html_personalizado = personalizar_html('C:/Users/navinchandry.ruas/Documents/.git/Regras/mail/avisoNCob1.html', valores)
                    html_corrigido = corrigir_codificacao(html_personalizado)
                    enviar_notificacao_supervisor(servidor['NomeServidor'], html_corrigido)
                    # Registrar no arquivo notificado.json que o servidor foi notificado duas vezes
                    notificados[servidor['NomeServidor']] = 2
                elif notificados[servidor['NomeServidor']] == 2:
                    # O servidor já foi notificado duas vezes, não enviar mais notificações
                    continue    

    # Salvar o arquivo notificado.json
    with open('notificado.json', 'w') as f:
        json.dump(notificados, f)


    """
    # Obter a lista de férias do banco SQL Auditor
    ferias = auditoria("SELECT * FROM Ferias")
    # Verificar se a variável ferias é None
    if ferias is None:
        print("Erro: a função auditoria('SELECT * FROM Ferias') retornou None")
        return
    # Verificar se a variável ferias é iterável
    if not isinstance(ferias, (list, tuple)):
        print(f"Erro: a função auditoria('SELECT * FROM Ferias') retornou um valor não iterável: {ferias}")
        return
    """

    # Obter a data atual
    hoje = datetime.now().date()

    """
    # Criar uma lista vazia para armazenar os nomes dos servidores em férias
    servidores_em_ferias = []
    # Iterar sobre a lista de férias
    for ferias_servidor in ferias:
        # Obter o nome do servidor
        nome_servidor = ferias_servidor[0]
        
        # Iterar sobre os períodos de férias do servidor
        for i in range(1, len(ferias_servidor), 2):
            # Obter a data de início e a duração do período de férias
            data_inicio_str = ferias_servidor[i]
            duracao_str = ferias_servidor[i+1]
            
            # Verificar se data_inicio_str e duracao_str não estão vazios
            if data_inicio_str and duracao_str:
                # Converter data_inicio_str para um objeto datetime
                data_inicio = datetime.strptime(data_inicio_str, '%d/%m/%Y').date()
                
                # Converter duracao_str para um inteiro
                duracao = int(duracao_str)
                
                # Calcular a data de término do período de férias
                data_termino = data_inicio + timedelta(days=duracao)
                
                # Verificar se hoje está dentro do período de férias
                if data_inicio <= hoje <= data_termino:
                    # Adicionar o nome do servidor à lista servidores_em_ferias
                    servidores_em_ferias.append(nome_servidor)
                    break
    print(f"Servidores em férias: {servidores_em_ferias}")  
    """


[{'NomeServidor': 'LENICE MEDEIROS', 'SiglaUnidade': 'AUDIN     ', 'NomeUnidade': 'AUDITORIA INTERNA                       ', 'tfnDescricao': None, 'SituacaoPactoTrabalho': 'Executado', 'TipoPGD': 'Teletrabalho Parcial', 'titulo': 'ATV-01 - Participação em sessões e grupos de trabalho, reuniões e oficinas de equipe, de colegiado, de comissões e comitês.', 'pactoTrabalhoId': '3ECC3868-1FE9-4AF0-B486-926B561962A2', 'planoTrabalhoId': 'BFAAF98C-5A82-4F31-AAAA-07150A929CCC', 'DtInicioPactoTrab': '2022-07-14', 'DtFimPactoTrab': '2022-10-13', 'tempoComparecimento': None, 'cargaHorariaDiaria': 8, 'percentualExecucao': Decimal('100.00'), 'relacaoPrevistoRealizado': Decimal('100.00'), 'avaliacaoId': None, 'tempoTotalDisponivel': 528, 'quantidade': 1, 'tempoPrevistoPorItem': 
Decimal('2.0'), 'tempoPrevistoTotal': Decimal('2.0'), 'DtInicioPactoTrabAtividade': datetime.datetime(2022, 7, 26, 10, 10), 'DtFimPactoTrabAtividade': datetime.datetime(2022, 7, 26, 12, 20), 'tempoRealizado': Decimal('2.0'), 'SituaçãoAtividade': 'Concluída', 'descricao': 'Reuniões semanais 
para alinhamento das atividades de Auditoria.', 'tempoHomologado': Decimal('2.0'), 'nota': Decimal('9.00'), 'justificativa': None, 'consideracoesConclusao': 'Reunião de apresentação da equipe com o novo auditor-chefe'}, {'NomeServidor': 'LENICE MEDEIROS', 'SiglaUnidade': 'AUDIN     ', 'NomeUnidade': 'AUDITORIA INTERNA                       ', 'tfnDescricao': None, 'SituacaoPactoTrabalho': 'Executado', 'TipoPGD': 'Teletrabalho Parcial', 'titulo': 'ATV-02 - Planejamento e preparação de documentos para sessões e grupos de trabalho, reuniões e oficinas, e consolidação de seus resultados.', 'pactoTrabalhoId': '3ECC3868-1FE9-4AF0-B486-926B561962A2', 'planoTrabalhoId': 'BFAAF98C-5A82-4F31-AAAA-07150A929CCC', 'DtInicioPactoTrab': '2022-07-14', 'DtFimPactoTrab': '2022-10-13', 'tempoComparecimento': None, 'cargaHorariaDiaria': 8, 'percentualExecucao': Decimal('100.00'), 
'relacaoPrevistoRealizado': Decimal('100.00'), 'avaliacaoId': None, 'tempoTotalDisponivel': 528, 
'quantidade': 1, 'tempoPrevistoPorItem': Decimal('1.0'), 'tempoPrevistoTotal': Decimal('1.0'), 'DtInicioPactoTrabAtividade': datetime.datetime(2022, 7, 27, 14, 30), 'DtFimPactoTrabAtividade': datetime.datetime(2022, 7, 27, 15, 30), 'tempoRealizado': Decimal('1.0'), 'SituaçãoAtividade': 'Concluída', 'descricao': 'Preparação das reuniões, elaboração de mémorias e atas - alinhamento das ações de auditoria.', 'tempoHomologado': Decimal('1.0'), 'nota': Decimal('9.00'), 'justificativa': None, 'consideracoesConclusao': 'Reunião com o novo auditor-chefe - planejamento das ações de auditoria'}, {'NomeServidor': 'MARCO JOSE BIANCHINI', 'SiglaUnidade': 'AUDIN     ', 'NomeUnidade': 
'AUDITORIA INTERNA                       ', 'tfnDescricao': 'FPE-1022 ASSISTENTE', 'SituacaoPactoTrabalho': 'Executado', 'TipoPGD': 'Teletrabalho Parcial', 'titulo': 'ATV-01 - Participação em sessões e grupos de trabalho, reuniões e oficinas de equipe, de colegiado, de comissões e comitês.', 'pactoTrabalhoId': 'C6F0D153-52EA-489C-9D38-978A3281B623', 'planoTrabalhoId': 'BCBB697E-8B39-4797-9C1C-F83455D6C2E6', 'DtInicioPactoTrab': '2022-07-18', 'DtFimPactoTrab': '2022-10-17', 'tempoComparecimento': None, 'cargaHorariaDiaria': 8, 'percentualExecucao': Decimal('100.00'), 'relacaoPrevistoRealizado': Decimal('100.00'), 'avaliacaoId': None, 'tempoTotalDisponivel': 528, 'quantidade': 1, 'tempoPrevistoPorItem': Decimal('2.0'), 'tempoPrevistoTotal': Decimal('2.0'), 'DtInicioPactoTrabAtividade': datetime.datetime(2022, 7, 18, 9, 11), 'DtFimPactoTrabAtividade': datetime.datetime(2022, 7, 18, 11, 50), 'tempoRealizado': Decimal('2.0'), 'SituaçãoAtividade': 'Concluída', 'descricao': 'Reuniões para discussão sobre alinhamentos e objetivos de trabalho. Projeto de aprimoramento dos exames, avaliações e indicadores do Inep. ', 'tempoHomologado': Decimal('2.0'), 'nota': Decimal('9.00'), 'justificativa': None, 'consideracoesConclusao': 'Alinhamento de atividades'}, {'NomeServidor': 'LENICE MEDEIROS', 'SiglaUnidade': 'AUDIN     ', 'NomeUnidade': 'AUDITORIA INTERNA                       ', 'tfnDescricao': None, 'SituacaoPactoTrabalho': 'Executado', 'TipoPGD': 'Teletrabalho Parcial', 'titulo': 'ATV-08 - Pesquisa, elaboração, análise e revisão de procedimentos e normativos.', 'pactoTrabalhoId': '3ECC3868-1FE9-4AF0-B486-926B561962A2', 'planoTrabalhoId': 'BFAAF98C-5A82-4F31-AAAA-07150A929CCC', 'DtInicioPactoTrab': '2022-07-14', 'DtFimPactoTrab': '2022-10-13', 'tempoComparecimento': None, 'cargaHorariaDiaria': 8, 'percentualExecucao': Decimal('100.00'), 'relacaoPrevistoRealizado': Decimal('100.00'), 'avaliacaoId': None, 'tempoTotalDisponivel': 528, 'quantidade': 1, 'tempoPrevistoPorItem': Decimal('80.0'), 'tempoPrevistoTotal': Decimal('80.0'), 'DtInicioPactoTrabAtividade': datetime.datetime(2022, 7, 14, 7, 0), 'DtFimPactoTrabAtividade': datetime.datetime(2022, 8, 10, 17, 0), 'tempoRealizado': Decimal('80.0'), 'SituaçãoAtividade': 'Concluída', 'descricao': '11- Plano de gestão de riscos, integridade e governança - Análise crítica dos normativos propostos no âmbito do Projeto Estratégico \nMinuta 1 - Política de 
Gestão de Risco do Inep\nMinuta 2 - Revisão do Programa de Integridade\nMinuta 3 - Plano de gestão de riscos e integridade', 'tempoHomologado': Decimal('80.0'), 'nota': Decimal('9.00'), 'justificativa': None, 'consideracoesConclusao': 'Análise crítica da Minuta sobre "Política de Governança, Gestão de riscos e Integridade" - Documento de análise/Minuta comentada'}, {'NomeServidor': 'MARCO JOSE BIANCHINI', 'SiglaUnidade': 'AUDIN     ', 'NomeUnidade': 'AUDITORIA INTERNA
          ', 'tfnDescricao': 'FPE-1022 ASSISTENTE', 'SituacaoPactoTrabalho': 'Executado', 'TipoPGD': 'Teletrabalho Parcial', 'titulo': 'ATV-01 - Participação em sessões e grupos de trabalho, reuniões e oficinas de equipe, de colegiado, de comissões e comitês.', 'pactoTrabalhoId': 'C6F0D153-52EA-489C-9D38-978A3281B623', 'planoTrabalhoId': 'BCBB697E-8B39-4797-9C1C-F83455D6C2E6', 'DtInicioPactoTrab': '2022-07-18', 'DtFimPactoTrab': '2022-10-17', 'tempoComparecimento': None, 'cargaHorariaDiaria': 8, 'percentualExecucao': Decimal('100.00'), 'relacaoPrevistoRealizado': Decimal('100.00'), 'avaliacaoId': None, 'tempoTotalDisponivel': 528, 'quantidade': 1, 'tempoPrevistoPorItem': Decimal('2.0'), 'tempoPrevistoTotal': Decimal('2.0'), 'DtInicioPactoTrabAtividade': datetime.datetime(2022, 7, 29, 16, 0), 'DtFimPactoTrabAtividade': datetime.datetime(2022, 9, 29, 18, 0), 'tempoRealizado': Decimal('2.0'), 'SituaçãoAtividade': 'Concluída', 'descricao': 'Reuniões para discussão de alinhamento sobre atividades executadas. Projeto de aprimoramento dos exames, avaliações 
e indicadores do Inep. ', 'tempoHomologado': Decimal('2.0'), 'nota': Decimal('9.00'), 'justificativa': None, 'consideracoesConclusao': 'Reuniões de alinhamento de atividades a serem executadas na semana sobre o objeto de auditoria.'}, {'NomeServidor': 'MARCO JOSE BIANCHINI', 'SiglaUnidade': 'AUDIN     ', 'NomeUnidade': 'AUDITORIA INTERNA                       ', 'tfnDescricao': 'FPE-1022 ASSISTENTE', 'SituacaoPactoTrabalho': 'Executado', 'TipoPGD': 'Teletrabalho Parcial', 'titulo': 'AUD-02 - Planejamento de ações e realização de estudos para elaboração da estratégia das ações de controle.', 'pactoTrabalhoId': 'C6F0D153-52EA-489C-9D38-978A3281B623', 'planoTrabalhoId': 'BCBB697E-8B39-4797-9C1C-F83455D6C2E6', 'DtInicioPactoTrab': '2022-07-18', 'DtFimPactoTrab': '2022-10-17', 'tempoComparecimento': None, 'cargaHorariaDiaria': 8, 'percentualExecucao': Decimal('100.00'), 'relacaoPrevistoRealizado': Decimal('100.00'), 'avaliacaoId': None, 'tempoTotalDisponivel': 
528, 'quantidade': 1, 'tempoPrevistoPorItem': Decimal('4.0'), 'tempoPrevistoTotal': Decimal('4.0'), 'DtInicioPactoTrabAtividade': datetime.datetime(2022, 9, 19, 8, 0), 'DtFimPactoTrabAtividade': datetime.datetime(2022, 9, 19, 12, 0), 'tempoRealizado': Decimal('4.0'), 'SituaçãoAtividade': 'Concluída', 'descricao': 'Planejar a atividade de monitoramento através do entendimento das recomendações. Projeto de aprimoramento dos exames, avaliações e indicadores do Inep. ', 'tempoHomologado': Decimal('4.0'), 'nota': Decimal('9.00'), 'justificativa': None, 'consideracoesConclusao': 'Realizado:\n1) o levantamento das recomendações relacionadas;\n2) compreensão das recomendações;\n3) estratégia de atendimento de acordo com manifestação da unidade auditada.'}, {'NomeServidor': 
'MARCO JOSE BIANCHINI', 'SiglaUnidade': 'AUDIN     ', 'NomeUnidade': 'AUDITORIA INTERNA
             ', 'tfnDescricao': 'FPE-1022 ASSISTENTE', 'SituacaoPactoTrabalho': 'Executado', 'TipoPGD': 'Teletrabalho Parcial', 'titulo': 'AUD-05 - Análise e revisão do plano de providências permanentes.', 'pactoTrabalhoId': 'C6F0D153-52EA-489C-9D38-978A3281B623', 'planoTrabalhoId': 'BCBB697E-8B39-4797-9C1C-F83455D6C2E6', 'DtInicioPactoTrab': '2022-07-18', 'DtFimPactoTrab': '2022-10-17', 'tempoComparecimento': None, 'cargaHorariaDiaria': 8, 'percentualExecucao': Decimal('100.00'), 'relacaoPrevistoRealizado': Decimal('100.00'), 'avaliacaoId': None, 'tempoTotalDisponivel': 528, 'quantidade': 1, 'tempoPrevistoPorItem': Decimal('3.0'), 'tempoPrevistoTotal': Decimal('3.0'), 'DtInicioPactoTrabAtividade': datetime.datetime(2022, 9, 21, 8, 0), 'DtFimPactoTrabAtividade': datetime.datetime(2022, 9, 21, 11, 0), 'tempoRealizado': Decimal('3.0'), 'SituaçãoAtividade': 'Concluída', 'descricao': 'Análise e emissão de posicionamento através do sistema e-Aud sobre recomendações emitidas. Projeto de aprimoramento dos exames, avaliações e indicadores do Inep.', 'tempoHomologado': Decimal('3.0'), 'nota': Decimal('9.00'), 'justificativa': None, 'consideracoesConclusao': 'Emissão de posicionamento da audin sobre as recomendações - via e-aud.'}, {'NomeServidor': 'LENICE MEDEIROS', 'SiglaUnidade': 'AUDIN     ', 'NomeUnidade': 'AUDITORIA INTERNA
      ', 'tfnDescricao': None, 'SituacaoPactoTrabalho': 'Executado', 'TipoPGD': 'Teletrabalho Parcial', 'titulo': 'AUD-02 - Planejamento de ações e realização de estudos para elaboração da estratégia das ações de controle.', 'pactoTrabalhoId': '3ECC3868-1FE9-4AF0-B486-926B561962A2', 'planoTrabalhoId': 'BFAAF98C-5A82-4F31-AAAA-07150A929CCC', 'DtInicioPactoTrab': '2022-07-14', 'DtFimPactoTrab': '2022-10-13', 'tempoComparecimento': None, 'cargaHorariaDiaria': 8, 'percentualExecucao': Decimal('100.00'), 'relacaoPrevistoRealizado': Decimal('100.00'), 'avaliacaoId': None, 'tempoTotalDisponivel': 528, 'quantidade': 1, 'tempoPrevistoPorItem': Decimal('16.0'), 'tempoPrevistoTotal': Decimal('16.0'), 'DtInicioPactoTrabAtividade': datetime.datetime(2022, 9, 8, 8, 0), 'DtFimPactoTrabAtividade': datetime.datetime(2022, 9, 9, 17, 0), 'tempoRealizado': Decimal('16.0'), 'SituaçãoAtividade': 'Concluída', 'descricao': '11- Plano de gestão de riscos, integridade e governança: Planejamento de ações e realização de estudos.', 'tempoHomologado': Decimal('16.0'), 'nota': Decimal('9.00'), 'justificativa': None, 'consideracoesConclusao': 'Curso CGU - Planejamento de auditorias'}, {'NomeServidor': 'MARCO JOSE BIANCHINI', 'SiglaUnidade': 'AUDIN     ', 'NomeUnidade': 'AUDITORIA INTERNA                       ', 'tfnDescricao': 'FPE-1022 ASSISTENTE', 'SituacaoPactoTrabalho': 'Executado', 'TipoPGD': 'Teletrabalho Parcial', 'titulo': 'AUD-07 - Benefícios financeiros ou não financeiros resultantes das ações de auditoria: instrução e análise.', 'pactoTrabalhoId': 'C6F0D153-52EA-489C-9D38-978A3281B623', 'planoTrabalhoId': 'BCBB697E-8B39-4797-9C1C-F83455D6C2E6', 'DtInicioPactoTrab': '2022-07-18', 'DtFimPactoTrab': '2022-10-17', 'tempoComparecimento': None, 'cargaHorariaDiaria': 8, 'percentualExecucao': Decimal('100.00'), 'relacaoPrevistoRealizado': Decimal('100.00'), 'avaliacaoId': None, 'tempoTotalDisponivel': 528, 'quantidade': 1, 'tempoPrevistoPorItem': Decimal('2.0'), 'tempoPrevistoTotal': Decimal('2.0'), 'DtInicioPactoTrabAtividade': datetime.datetime(2022, 9, 21, 14, 0), 'DtFimPactoTrabAtividade': datetime.datetime(2022, 9, 21, 16, 0), 'tempoRealizado': Decimal('2.0'), 'SituaçãoAtividade': 'Concluída', 'descricao': 'Apuração do benefício financeiro ou não financeiro via sistema e-Aud. Projeto de aprimoramento dos exames, avaliações e indicadores do Inep.', 'tempoHomologado': Decimal('2.0'), 'nota': Decimal('9.00'), 'justificativa': None, 'consideracoesConclusao': 'Contabilização de benefícios das recomendações concluídas, conforme e-aud.'}, {'NomeServidor': 'LENICE MEDEIROS', 'SiglaUnidade': 'AUDIN     
', 'NomeUnidade': 'AUDITORIA INTERNA                       ', 'tfnDescricao': None, 'SituacaoPactoTrabalho': 'Executado', 'TipoPGD': 'Teletrabalho Parcial', 'titulo': 'AUD-03 - Execução de ação 
de controle.', 'pactoTrabalhoId': '3ECC3868-1FE9-4AF0-B486-926B561962A2', 'planoTrabalhoId': 'BFAAF98C-5A82-4F31-AAAA-07150A929CCC', 'DtInicioPactoTrab': '2022-07-14', 'DtFimPactoTrab': '2022-10-13', 'tempoComparecimento': None, 'cargaHorariaDiaria': 8, 'percentualExecucao': Decimal('100.00'), 'relacaoPrevistoRealizado': Decimal('100.00'), 'avaliacaoId': None, 'tempoTotalDisponivel': 528, 'quantidade': 1, 'tempoPrevistoPorItem': Decimal('40.0'), 'tempoPrevistoTotal': Decimal('40.0'), 'DtInicioPactoTrabAtividade': datetime.datetime(2022, 8, 4, 7, 37), 'DtFimPactoTrabAtividade': datetime.datetime(2022, 8, 5, 16, 37), 'tempoRealizado': Decimal('16.0'), 'SituaçãoAtividade': 
'Concluída', 'descricao': '11- Plano de gestão de riscos, integridade e governança: Execução das 
 atividades referentes às ações de controle (Riscos de Integridade).', 'tempoHomologado': Decimal('40.0'), 'nota': Decimal('9.00'), 'justificativa': None, 'consideracoesConclusao': 'Estudos sobre gestão de riscos'}, {'NomeServidor': 'MARCO JOSE BIANCHINI', 'SiglaUnidade': 'AUDIN     ', 'NomeUnidade': 'AUDITORIA INTERNA                       ', 'tfnDescricao': 'FPE-1022 ASSISTENTE', 'SituacaoPactoTrabalho': 'Executado', 'TipoPGD': 'Teletrabalho Parcial', 'titulo': 'ATV-01 - Participação em sessões e grupos de trabalho, reuniões e oficinas de equipe, de colegiado, de comissões 
e comitês.', 'pactoTrabalhoId': 'C6F0D153-52EA-489C-9D38-978A3281B623', 'planoTrabalhoId': 'BCBB697E-8B39-4797-9C1C-F83455D6C2E6', 'DtInicioPactoTrab': '2022-07-18', 'DtFimPactoTrab': '2022-10-17', 'tempoComparecimento': None, 'cargaHorariaDiaria': 8, 'percentualExecucao': Decimal('100.00'), 'relacaoPrevistoRealizado': Decimal('100.00'), 'avaliacaoId': None, 'tempoTotalDisponivel': 528, 'quantidade': 1, 'tempoPrevis


from emailFunc import enviar_notificacao, enviar_notificacao_supervisor
from extraUtils import personalizar_html, gap, stripFunc, normalize
from Conexao import pontalina, auditoria

def verificar_campo_descricao():
    dados = pontalina("SELECT [NomeServidor], [pactoTrabalhoId], [titulo], [descricao] FROM [ProgramaGestao].[VW_PlanoTrabalhoAUDIN] WHERE [SituacaoPactoTrabalho] = 'Executado' and descricao like '%<demanda>%%</demanda>%'")
    depara = auditoria("SELECT * FROM eAud.`De-Para`")

    for dado in dados:
        demanda = stripFunc(dado['descricao'], 'demanda')
        atividade = stripFunc(dado['descricao'], 'atividade')
        produto = stripFunc(dado['descricao'], 'produto')
        atividadeSISGP = dado['titulo']

        # Check if the order of demanda, atividade, and produto is valid
        if depara is not None:
            for row in depara:
                # Use integer indices to access the elements of the row tuple
                if row[0] == demanda and row[2] == atividade and row[4] == produto:
                    # The order is valid
                    print(f"Servidor {dado['NomeServidor']} possui demanda, atividade e produto na ordem correta")
                    compAtv = f"{row[6]}-{row[7]} - {row[8]}"

                    if compAtv == atividadeSISGP or normalize(compAtv) == normalize(atividadeSISGP):
                        print(f"Servidor {dado['NomeServidor']} possui atividade SISGP correta")
                        html = personalizar_html(gap('mail\\descCorreto.html'), {'nome': dado['NomeServidor'], 'descricao': dado['descricao'], 'atividade': atividadeSISGP, 'trabalhoid': dado['pactoTrabalhoId']})
                        enviar_notificacao_supervisor(dado['NomeServidor'], html)
                    else:
                        print(f"Servidor {dado['NomeServidor']} possui atividade SISGP incorreta")
                        html = personalizar_html(gap('mail\\AtvErrada.html'), {'nome': dado['NomeServidor'], 'descricao': dado['descricao'], 'atividade': atividadeSISGP, 'trabalhoid': dado['pactoTrabalhoId']})
                        enviar_notificacao(dado['NomeServidor'], html)
                        pass

                    break
            else:
                print(f"Servidor {dado['NomeServidor']} possui demanda, atividade e produto na ordem incorreta")
                html = personalizar_html(gap('mail\\descErrada.html'), {'nome': dado['NomeServidor'], 'descricao': dado['descricao'], 'atividade': atividadeSISGP, 'trabalhoid': dado['pactoTrabalhoId']})
                enviar_notificacao(dado['NomeServidor'], html)
                pass